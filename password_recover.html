<!DOCTYPE html>
<html lang="es">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.8.2/css/all.css">
  <link href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.3.1/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdnjs.cloudflare.com/ajax/libs/mdbootstrap/4.8.9/css/mdb.min.css" rel="stylesheet">
  <link rel="stylesheet" href="css/login.css">
  <link rel="stylesheet" href="css/loader.css">
  <title>Recuperar contraseña</title>

</head>

<body>

    <div style="display:none" class="loading"></div>
    
  <!-- Main navigation -->
  <header>

    <!-- Full Page Intro -->
    <div class="view" style="background-image: url('images/back.jpg'); background-repeat: no-repeat; background-size: cover; background-position: center center;">
      <!-- Mask & flexbox options-->
      <div class="mask rgba-gradient align-items-center">
        <!-- Content -->
        <div class="container">
          <!--Grid row-->
          <div class="row">
            <!--Grid column-->
            <div style="padding-top: 10%;" class="col-md-12 white-text text-center text-md-left mt-xl-5 mb-5 margin22 wow fadeInRight" data-wow-delay="0.3s">
              <!--Form-->
        
                <div class="card wow fadeInRight" data-wow-delay="0.3s">
                  <div class="card-body">
                    <!--Header-->
                    <div class="text-center">
                      <h4>
                        <i class="fas fa-user violet-text"></i> Recuperar contraseña:</h4>
                      <hr class="hr-gris">
                    </div>
                    <!--Body-->

                    <div class="md-form">
                      <i class="fas fa-envelope prefix white-text violet active  iconitos"></i>
                      <input type="email" id="email" class="indigo-text form-control">
                      <label for="">Email</label>
                    </div>

                    <div class="text-center mt-4">
                      <button onclick="recoverPassword()" class="btn btn-indigo">Recuperar contraseña</button>

                      <hr class="hr-gris mb-3 mt-4">
                      <div class="inline-ul text-center">
                          
                        <a href="index.html" class="white-text">
                          <i class="fas fa-sign-in-alt mr-3"></i>
                          Iniciar sesión</a><br>

                      </div>
                    </div>
                  </div>
                </div>
 
            </div>
            <!--Grid column-->

          </div>
          <!--Grid row-->
        </div>
        <!-- Content -->
      </div>
      <!-- Mask & flexbox options-->
    </div>
    <!-- Full Page Intro -->
  </header>
  <!-- Main navigation -->
  <!--Main Layout-->
    <!-- <main> -->
      <!-- <div class="container"> -->
        <!--Grid row-->
        <!-- <div class="row py-5"> -->
          <!--Grid column-->
          <!-- <div class="col-md-12 text-center"> -->
            <!-- <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.</p>
          </div> -->
          <!--Grid column-->
        <!-- </div> -->
        <!--Grid row-->
      <!-- </div> -->
    <!-- </main> -->
  <!--Main Layout-->

</body>

<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.4/umd/popper.min.js"></script>
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.3.1/js/bootstrap.min.js"></script>
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mdbootstrap/4.8.9/js/mdb.min.js"></script>
<script src="lib/jquerysession.js"></script>
<script src="lib/helper.js"></script>
<script>
  // Animations init
  new WOW().init();

  $(document).ready(function(){

    $('#cedula').change(function(){

      $ced = $('#cedula').val();

      if(!comprobarCI($ced) || $ced == '' ){
        $( "<span id='smallError' class='ml-5 py-0 '></span>" ).appendTo( "#errorDiv" );
          $('#smallError').html('✘ Cedula inválida');
          $('#smallError').addClass('text-warning');
          return false;
        }

      $.ajax({
        type: "POST",
        url: "https://vida-apps.com/vidapesos/ajax/chequearUsuario.php",
        data: {usuario:$ced},
        dataType: "JSON",
        success: function (res) {
          if(res.result){
            $( "<span id='smallError' class='ml-5 py-0 '></span>" ).appendTo( "#errorDiv" );
            $('#smallError').html('✓ Cédula correcta');
            $('#smallError').addClass('text-success');
          }else{
            $( "<span id='smallError' class='ml-5 py-0 '></span>" ).appendTo( "#errorDiv" );
            $('#smallError').html('✘ La cedula no es socio de vida o no esta ingresada por un comercio');
          }
        }
      });

    });

  });

  async function recoverPassword() {

        $email      = $('#email').val();


        if(!validateEmail($email)){
          alert('Email inválido!');
          return false;
        }


        $todoOk = false;

        await $.ajax({
          type: "POST",
          url: "https://vida-apps.com/vidapesos/ajax/chequearUsuario.php",
          data: {email:$email},
          dataType: "JSON",
          success: function (res) {
            if(res.result){
              $todoOk = true;
            }else{
              alert(res.message);
              return false;
            }
          }

        });

        if($todoOk){
          $.ajax({
        type: "POST",
        url: "https://vida-apps.com/vidapesos/ajax/recoverPassword.php",
        data: {email:$email},
        dataType: "JSON",
        beforeSend: function(){
          $('.loading').css('display','block');
        },
        success: function(res) {
          if(res.result){
            $('.loading').css('display','none');
            alert(res.message);
            location.replace('index.html');
          }else{
            $('.loading').css('display','none');
            alert(res.message);
          }

        }

        });

        }

    }


</script>
</body>

</html>