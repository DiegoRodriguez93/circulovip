<!DOCTYPE html>
<html lang="es">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <meta http-equiv="Cache-Control" content="no-cache" />
  <meta http-equiv="Pragma" content="no-cache" />
  <meta http-equiv="Expires" content="0" />
  <title>Circulo Vip</title>
  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.8.2/css/all.css">
  <link href="css/bootstrap.min.css" rel="stylesheet">
  <link href="css/mdb.min.css" rel="stylesheet">
  <link href="css/style.css" rel="stylesheet">
  <link rel="stylesheet" href="css/loader.css">
  <link href="../css/estilosmenu.css" rel="stylesheet">
  <style>
  i{cursor: pointer;}
  </style>
 </head>
 <body>

  <!-- Modal CAMBIAR DATOS EMPRESA START -->
<div class="modal fade" id="datosEmpresa" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
  <div class="modal-dialog" role="document" data-backdrop="static" data-keyboard="false">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="exampleModalLabel">Actualizar datos empresa</h5>
      </div>
      <div class="modal-body">
        <label for="nombre_empresa">Nombre</label>
        <input type="text" class="form-control" id="nombre_empresa">
        <label for="descripcion_empresa">Acerca de la empresa:</label>
        <textarea id="descripcion_empresa" class="form-control" maxlength="250"></textarea>
        <label for="pais">País</label>
        <select id="pais" class="form-control">
          <option value="Internacional">Internacional</option>
          <option value="Argentina">Argentina</option>
          <option value="Bolivia">Bolivia</option>
          <option value="Brasil">Brasil</option>
          <option value="Chile">Chile</option>
          <option value="Colombia">Colombia</option>
          <option value="Ecuador">Ecuador</option>
          <option value="México">México</option>
          <option value="Panamá">Panamá</option>
          <option value="Paraguay">Paraguay</option>
          <option value="Perú">Perú</option>
          <option value="República Dominicana">República Dominicana</option>
          <option value="Uruguay">Uruguay</option>
          <option value="Venezuela">Venezuela</option>
        </select>
            </div>
      <div class="modal-footer"><div class="mx-auto">
        <button type="button" id="ActualizarDatosEmpresaBtn" onclick="ActualizarDatosEmpresa()" class="btn btn-deep-purple">Actualizar</button>
        <button type="button" class="btn btn-blue-grey" data-dismiss="modal">Cancelar</button>
      </div>
      </div>
    </div>
  </div>
</div> 
<!-- Modal CAMBIAR DATOS EMPRESA END -->

<!-- MODAL ACTUALIZAR DATOS PERSONALES -->
<div class="modal fade" id="datosPersonales" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
  <div class="modal-dialog" role="document" data-backdrop="static" data-keyboard="false">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="exampleModalLabel">Actualizar datos personales</h5>
      </div>
      <div class="modal-body">
        <label>Cargo</label>
        <input type="text" class="form-control" id="cargoPersona">
        <label>Acerca de mi:</label>
        <textarea id="acerca_de_miPersona" class="form-control" maxlength="250"></textarea>
            </div>
      <div class="modal-footer"><div class="mx-auto">
        <button type="button" id="ActualizarDatosPersonalesBtn" onclick="ActualizarDatosPersonales()" class="btn btn-deep-purple">Actualizar</button>
        <button type="button" class="btn btn-blue-grey" data-dismiss="modal">Cancelar</button>
      </div>
      </div>
    </div>
  </div>
</div>
<!-- MODAL ACTUALIZAR DATOS PERSONALES END -->



  <header>

    <!-- Navbar -->

      <div class="container-fluid">

        <!-- Brand -->


        <div id="menuToggle" >

          <input type="checkbox">
          <span></span>
          <span></span>
          <span></span>
        </div>

      </div>
 
    <!-- Navbar -->

    <!-- SIDEBAR AQUI -->

<div id="sidebar_aqui"></div>


  </header>
  <!--Main Navigation-->

  <div style="background-image: url('../images/back1.jpg');position:fixed;height: 250px;width: 100%;display: none;"></div>
  <!--Main layout-->
  <main class="pt-3 mx-lg-5">
    <div class="container-fluid mt-5" style="min-height: 480px">

      
      
      <!--Grid row-->
      <div class="row wow fadeIn">

        <!--Grid column-->
        <div class="col-md-5 sm-12 mb-4">

          <div class="card">

                <div class="card-body my-auto mx-auto">
                  <div class="row">
                    <div class="col-10">
                      <img src="" 
                      id="enterprise_image" class="img-fluid" alt="">
                    </div>
                    <div class="col-2 my-auto mx-auto">
                      <label for="enterprisePicture" class="text-success"><i class="fas fa-upload fa-2x"></i></label>
                      <input type="file" style="display: none;" id="enterprisePicture">
                    </div>
                  </div>

                
                </div>

        </div>
        </div>
        <!--Grid column-->


      <!--Grid column-->
      <div class="col-md-5 sm-12 mb-4 my-auto">

        <div class="card">

              <div class="card-body">
                <div class="row">
                  <div class="col-10">
                    <h4 id="nombreEmpresa" class="d-inline"></h4 class="d-inline"> <h5 id="paisEmpresa" class="d-inline"></h5>
                    <h6 id="descripcionEmpresa">
                    </h6>
                  </div>
                  <div class="col-2 my-auto">
                    <h8 onclick="$('#datosEmpresa').modal('show');" class="text-success"><i class="fas fa-pen fa-2x"></i></h8>
                  </div>
                </div>


              </div>

      </div>
      </div>
      <!--Grid column-->

      <!--Grid column-->
      <div class="col-md-2 sm-0 mb-4">
      </div>
      <!--Grid column-->





      </div>
      <!--Grid row-->

      <!--Grid row-->
      <div class="row wow fadeIn">

        <!--Grid column-->
        <div class="col-md-8 mb-4">
          <div style="display:none" class="loading"></div>
          <!--Card-->
          <div class="card">

              <h4 class="card-header">
                     Mi cuenta
              </h4>
              <div id="card-body p-2"><h5>
                <div id="emailPersonal" class="my-2 mx-2"></div>
                <div id="vencimientoPersonal" class="my-2 mx-2"></div></h5>
              </div>
          </div>
          <!--/.Card-->
          <div class="mb-5"></div>
        </div>
        <!--Grid column-->

        
        <!--Grid column-->
        <div class="col-md-4 mb-4">

          <!--Card-->
          <div class="card">
            <div class="text-center">
              <img src="../images/profile.jpg" style="transform: translateY(-52px);"
               alt="foto_carita" height="140" width="140" id="foto_carita" class="img-fluid rounded-circle">
               <input type="file" id="profilePicture" style="display:none;"/>
               <label for="profilePicture"><h8 class="text-success"><i class="fas fa-upload fa-2x"></i></h8></label>
            </div>
            <div class="row  text-center">
              <div class="col-10">
                <div class="p-2">
                  <div id="nombre_completo" class="mb-2" style="font-size: 1.4em;"></div>
                <b><label for="cargo">Cargo</label></b>
                  <div id="cargo" class="mb-2" style="font-size: 1.4em;"></div>
                <b><label for="acerca_de_mi">Acerca de mi</label></b>
                <blockquote class="blockquote">
                  <footer id="acerca_de_mi" class="blockquote-footer"></footer>
                </blockquote>
                </div>
              </div>
              <div class="col-2 my-auto">
                <h8 onclick="$('#datosPersonales').modal('show');" class="text-success"> <i class="fas fa-pen"></i> </h8>
              </div>
            </div>


          </div>
          <!--/.Card-->
          <div class="mb-5"></div>
        </div>
        <!--Grid column-->

      </div>
      <!--Grid row-->


    </div>
  </main>
  <!--Main layout-->

  <!--Footer-->
  <footer class="page-footer text-center font-small deep-purple darken-1 mt-4 wow fadeIn" style="
bottom: 0;position: fixed;width: 100%;
">

    <!--Copyright-->
    <div class="footer-copyright py-3">
      © 2020 Copyright
      <a href="https://circulovip.com" target="_blank"> Circulo Vip Empresarial </a>
    </div>
    <!--/.Copyright-->

  </footer>
  <!--/.Footer-->

  <div id="modal_aqui"></div>

  <!-- SCRIPTS -->
  <script type="text/javascript" src="js/jquery-3.4.1.min.js"></script>
  <script type="text/javascript" src="js/popper.min.js"></script>
  <script type="text/javascript" src="js/bootstrap.min.js"></script>
  <script type="text/javascript" src="js/mdb.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@9"></script>
  <script src="js/cerrar_session.js"></script>
  <script src="include/sidebar.js"></script>
  <script>

    function ActualizarDatosPersonales(){
      $cargo = $('#cargoPersona').val();
      $acerca_de_mi = $('#acerca_de_miPersona').val();

      $.ajax({
        type: "POST",
        url: "../ajax/socio/mi_perfil/actualizar_datos_personales.php",
        data: {id_user:localStorage.getItem('id_user'),
        cargo: $cargo,
        acerca_de_mi:$acerca_de_mi
        },        
        beforeSend: () => {
          Swal.fire({
            title: 'Actualizando...',
            allowEscapeKey: false,
            allowOutsideClick: false,
            onOpen: () => {
              Swal.showLoading();
            }
          })}, 
        dataType: "JSON",
        success: function (res) {
          if(res.result){
            $('#cargo').html(res.cargo);
            $('#acerca_de_mi').html(res.acerca_de_mi);
            $('#datosPersonales').modal('hide');
            Swal.fire(
            'Ok!',
            res.message,
            'success'
            )
          }
        }
      });
    }

    function ActualizarDatosEmpresa(){

     $nombre = $('#nombre_empresa').val();
     $descripcion = $('#descripcion_empresa').val();
     $pais = $('#pais').val();

      if($nombre.length < 1){
        alert('El nombre de la empresa no puede estar vacio');
      }

      $.ajax({
        type: "POST",
        url: "../ajax/socio/mi_perfil/actualizar_datos_empresa.php",
        data: {id_user:localStorage.getItem('id_user'),
        nombre: $nombre,
        descripcion:$descripcion,
        pais:$pais
        },
        dataType: "JSON",     
        beforeSend: () => {
          Swal.fire({
            title: 'Actualizando...',
            allowEscapeKey: false,
            allowOutsideClick: false,
            onOpen: () => {
              Swal.showLoading();
            }
          })}, 
        success: function (res) {
          if(res.result){
            $('#nombreEmpresa').html(res.nombre);
            $('#descripcionEmpresa').html(res.descripcion);
            $('#paisEmpresa').html("("+res.pais+")");
            $('#datosEmpresa').modal('hide');
            Swal.fire(
            'Ok!',
            res.message,
            'success'
            )
          }
        }
      });

    }
  

  $(document).ready(function(){

    /* RELLENO LOS DATOS DE LA PERSONA */

    $.ajax({
      type: "POST",
      url: "../ajax/socio/mi_perfil/cargar_datos_usuario.php",
      data: {id_user:localStorage.getItem('id_user')},
      dataType: "JSON",
      beforeSend: function(){
        $('.loading').css('display','block');
      },
      success: function (res) {
        $('.loading').css('display','none');
        if(res.result){
        $('#nombre_completo').html(res.nombre_completo);
        $('#cargo').html(res.cargo);
        $('#acerca_de_mi').html(res.acerca_de_mi);
        $('#cargoPersona').val(res.cargo);
        $('#acerca_de_miPersona').html(res.acerca_de_mi);
        $('#emailPersonal').html('Dirección de correo electrónico asociado a la cuenta : <b>'+res.emailPersona+'</b>');
        $('#vencimientoPersonal').html('Fecha de finalización de la suscripción : <b>'+res.vencimientoPersona+'</b>');
        }
        if(res.url_avatar != null){
          $('#foto_carita').attr('src',res.url_avatar);
        }else{  
          $('#foto_carita').attr('src','../images/profile.jpg');
        }
        if(res.url_empresa != null){
          $('#enterprise_image').attr('src',res.url_empresa);
        }else{  
          $('#enterprise_image').attr('src','../images/greyenterprice.jpg');
        }
        if(res.nombre_empresa != null){
          $('#nombreEmpresa').html(res.nombre_empresa);
          $('#nombre_empresa').val(res.nombre_empresa);
        }else{
          $('#nombreEmpresa').html('Tu Empresa');
        }
        if(res.pais_empresa != null){
          $('#paisEmpresa').html('('+res.pais_empresa+')');
          $('#pais').val(res.pais_empresa);
        }else{
          $('#paisEmpresa').html('(Internacional)');
        }
        if(res.descripcion_empresa != null){
          $('#descripcionEmpresa').html(res.descripcion_empresa);
          $('#descripcion_empresa').val(res.descripcion_empresa);
        }else{
          $('#descripcionEmpresa').html('Breve descripción de tu empresa..');
        }

      }
    });

/* INCLUDES */

$('#sidebar_aqui').html(sidebar);

/* NAVBUTTON */

$('#menuToggle').on('click',function(){

$( "#sidebar" ).toggle("normal"); 


} );

  new WOW().init();

  checkLogIn();

  $('#indexSidebar').removeClass('active');
  $('#perfilSidebar').addClass('active');
  $('#empresasSidebar').removeClass('active');
  $('#horariosSidebar').removeClass('active');
  $('#productosSidebar').removeClass('active');
  $('#mensajesSidebar').removeClass('active');
  $('#salaDeEspera').removeClass('active');

  /* PROFILE PICTURE */

  
$("#profilePicture").change(function() {
    var file = this.files[0];
    var imagefile = file.type;
    var match= ["image/jpeg","image/png","image/jpg","image/webp","image/gif"];

    if(!((imagefile==match[0]) || (imagefile==match[1]) || (imagefile==match[2]) || (imagefile==match[3]) || (imagefile==match[4]) )){
        alert('Por favor seleccione un formato de imagen válido (JPEG/JPG/PNG/GIF/WEBP).');
        $("#profilePicture").val('');
        return false;
    }

    if(this.files[0].size > 614400){
        alert("El archivo es demasiado grande!");
        $("#profilePicture").val('');
        return false;
     };

     
    if($("#profilePicture").val() == ''){
      alert("El archivo es esta vacio!");
        return false;
    }
    var formData = new FormData();
    formData.append('id_user', localStorage.getItem('id_user'));
    formData.append('profilePicture', $('#profilePicture')[0].files[0]); 

    $.ajax({
    url: "../ajax/socio/mi_perfil/cargar_imagen_usuario.php",
    type: "POST",
    data : formData, 
    processData: false,
    contentType: false,
    success: function(res){

       var response = JSON.parse(res);

        if(response.result){
          Swal.fire(
            'Ok!',
            response.message,
            'success'
            );
            setTimeout(function(){
              location.reload();
            }, 2500)
   
        }else{
          Swal.fire(
            'Error!',
            response.message,
            'error'
            );
        }

    },
    error: function(xhr, ajaxOptions, thrownError) {
       console.log(thrownError + "\r\n" + xhr.statusText + "\r\n" + xhr.responseText);
    }
});
});

$("#enterprisePicture").change(function() {
    var file = this.files[0];
    var imagefile = file.type;
    var match= ["image/jpeg","image/png","image/jpg","image/webp","image/gif"];

    if(!((imagefile==match[0]) || (imagefile==match[1]) || (imagefile==match[2]) || (imagefile==match[3]) || (imagefile==match[4]) )){
        alert('Por favor seleccione un formato de imagen válido (JPEG/JPG/PNG/GIF/WEBP).');
        $("#enterprisePicture").val('');
        return false;
    }

    if(this.files[0].size > 614400){
        alert("El archivo es demasiado grande!");
        $("#enterprisePicture").val('');
        return false;
     };

     
    if($("#enterprisePicture").val() == ''){
      alert("El archivo es esta vacio!");
        return false;
    }
    var formData = new FormData();
    formData.append('id_user', localStorage.getItem('id_user'));
    formData.append('enterprisePicture', $('#enterprisePicture')[0].files[0]); 

    $.ajax({
    url: "../ajax/socio/mi_perfil/cargar_imagen_empresa.php",
    type: "POST",
    data : formData, 
    processData: false,
    contentType: false,
    success: function(res){

       var response = JSON.parse(res);

        if(response.result){
            Swal.fire(
            'Ok!',
            response.message,
            'success'
            );
            setTimeout(function(){
              location.reload();
            }, 2500)
        }else{
                        Swal.fire(
            'Error!',
            response.message,
            'error'
            );
        }

    },
    error: function(xhr, ajaxOptions, thrownError) {
       console.log(thrownError + "\r\n" + xhr.statusText + "\r\n" + xhr.responseText);
    }
});
});

});
  

  </script>

</body>

</html>