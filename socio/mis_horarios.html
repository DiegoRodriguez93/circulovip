<!DOCTYPE html>
<html lang="es">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <meta http-equiv="Cache-Control" content="no-cache" />
  <meta http-equiv="Pragma" content="no-cache" />
  <meta http-equiv="Expires" content="0" />
  <title>Circulo Vip</title>
  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.8.2/css/all.css">
  <link href="css/bootstrap.min.css" rel="stylesheet">
  <link href="css/mdb.min.css" rel="stylesheet">
  <link href="css/style.css" rel="stylesheet">
  <link rel="stylesheet" href="css/loader.css">
  <link href="../css/estilosmenu.css" rel="stylesheet">
  <style>
  span{
    cursor: pointer;
  }
  </style>
  </head><body>
 
  <!-- Modal EDITAR HORARIO START -->
<div class="modal fade" id="modalEditarHorario" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
  <div class="modal-dialog" role="document" data-backdrop="static" data-keyboard="false">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="exampleModalLabel">Proximas Citas</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">

        <label for="listadoCitas">Seleccione el día de la cita a editar:</label>
        <select name="" id="listadoCitas" class="form-control">
          <option value="">No hay proximas citas disponibles</option>
        </select>

      </div>
      <div class="modal-footer"><div class="mx-auto">
        <button type="button" onclick="editarHorarioDeCita()" class="btn btn-indigo">Editar Horarios</button>
      </div>
      </div>
    </div>
  </div>
</div> 
<!-- Modal EDITAR HORARIO END -->

<!-- MODAL CONFIRM TRANSACCIÓN-->
<div class="modal fade" id="confirmModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel"
  aria-hidden="true" data-backdrop="static" data-keyboard="false">

  <!-- Change class .modal-sm to change the size of the modal -->
  <div class="modal-dialog  modal-top" role="document">


    <div class="modal-content">
      <div class="modal-header">
        <h4 class="modal-title w-100" id="modalTitle"></h4>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <input type="hidden" id="hidden_id_cupon">
        <h3>Datos del comercio:</h3>
        <h4 id="commerce_name"></h4>
        <h4 id="commerce_address"></h4>
        <h4 id="commerce_phone"></h4>
        <hr>
        <h4 id="fecha_vencimiento"></h4>
        <h4 id="descuento"></h4>
      </div>
      <div class="modal-footer text-center mx-auto">
        <button type="button" id="confirmarTransaccionBtn" class="btn btn-indigo">Confirmar</button>
        <button type="button" id="cancelarTransaccionBtn" class="btn btn-blue-grey" data-dismiss="modal">Cancelar</button>
      </div>
    </div>
  </div>
</div>
<!-- MODAL CONFIRM TRANSACCIÓN-->

<!-- MODAL CONFIRM DESCUENTOS-->
<div class="modal fade" id="agregarHorarioMdl" tabindex="-1" role="dialog" aria-labelledby="myModalLabel"
  aria-hidden="true" data-backdrop="static" data-keyboard="false">

  <!-- Change class .modal-sm to change the size of the modal -->
  <div class="modal-dialog  modal-top" role="document">


    <div class="modal-content">
      <div class="modal-header">
        <h4 class="modal-title w-100">Agregar horario</h4>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <label for="hora">Hora</label>
        <input type="time" id="hora" class="form-control w-25">
        <div class="row mt-4">
          <div class="col"><b>LU</b>
          <input type="checkbox" id="1">
          </div>
          <div class="col"><b>MA</b><input type="checkbox" id="2">
          </div>
          <div class="col"><b>MI</b>
            <input type="checkbox" id="3">
          </div>
          <div class="col"><b>JU</b>
            <input type="checkbox" id="4">
          </div>
          <div class="col"><b>VI</b>
            <input type="checkbox" id="5">
          </div>
          <div class="col"><b>SA</b>
            <input type="checkbox" id="6">
          </div>
          <div class="col"><b>DO</b>
            <input type="checkbox" id="7">
          </div>
        </div>
          <div id="vencimientos"></div>
      </div>
      <div class="modal-footer text-center mx-auto">
        <button type="button" onclick="agregarHorario()" class="btn btn-deep-purple">Confirmar</button>
        <button type="button" class="btn btn-blue-grey" data-dismiss="modal">Cerrar</button>
      </div>
    </div>
  </div>
</div>
<!-- MODAL CONFIRM DESCUENTOS-->


<body class="grey lighten-3">

  <!--Main Navigation-->
  <header>

    <!-- Navbar -->

      <div class="container-fluid">

        <!-- Brand -->


        <div id="menuToggle" >

          <input type="checkbox">
          <span></span>
          <span></span>
          <span></span>
        </div>

      </div>
 
    <!-- Navbar -->

    <!-- SIDEBAR AQUI -->

<div id="sidebar_aqui"></div>


  </header>
  <!--Main Navigation-->

  <div style="background-image: url('../images/back1.jpg');position:fixed;height: 250px;width: 100%;display: none;"></div>
  <!--Main layout-->
  <main class="pt-3 mx-lg-5">
    <div class="container-fluid mt-5" style="min-height: 480px">

    
      <div class="row wow fadeIn">

        <div style="display:none" class="loading"></div>

        <!--Grid column-->
        <div class="col-md-12 mb-4">

          <!--Card-->
          <div class="card">

              <h4 class="card-header">
                    Horarios disponibles

              </h4>

              <div class="row wow fadeIn">
                <div class="col-lg-2 sm-0"></div>
                <div class="col-lg-4 md-6 sm-12 text-center">
                  <button 
                  onclick="$('#agregarHorarioMdl').modal('show');"
                  class="btn btn-success d-inline-block pt-3">
                     <i class="fa fa-clock fa-2x d-inline-block"></i>
                      <h5 class="d-inline-block" style="transform: translateY(-2px);"><br>Agregar Horarioㅤㅤㅤ</h5>
                    </button>
                </div>
                <div class="col-lg-4 md-6 sm-12 text-center">
                  <button 
                  onclick="rellenarListadoDeCitasYabrirModal();"
                  class="btn btn-success d-inline-block pt-3">
                     <i class="fa fa-clock fa-2x d-inline-block"></i>
                      <h5 class="d-inline-block" style="transform: translateY(-2px);"><br>Editar Horarios de Citas</h5>
                    </button>
                </div>
                <div class="col-lg-2 sm-0"></div>
              </div>

              
          </div>        

          <div style="display:none" class="loading"></div>

   <!--        <div class="card my-3"> -->
            <div id="dateContainer" class="row wow fadeIn my-3">

              
    
        </div>
   <!--      </div> -->
      



          <!--/.Card-->
          <div class="mb-5"></div>

        <!--Grid column-->

        
      </div>
      </div>
      <!--Grid row-->


    </div>
  </main>
  <!--Main layout-->

  <!--Footer-->
  <footer class="page-footer text-center font-small deep-purple darken-1 mt-4 wow fadeIn" style="
bottom: 0;position: fixed;width: 100%;
">

    <!--Copyright-->
    <div class="footer-copyright py-3">
      © 2020 Copyright
      <a href="https://circulovip.com" target="_blank"> Circulo Vip Empresarial </a>
    </div>
    <!--/.Copyright-->

  </footer>
  <!--/.Footer-->

  <div id="modal_aqui"></div>

  <!-- SCRIPTS -->
  <script type="text/javascript" src="js/jquery-3.4.1.min.js"></script>
  <script type="text/javascript" src="js/popper.min.js"></script>
  <script type="text/javascript" src="js/bootstrap.min.js"></script>
  <script type="text/javascript" src="js/mdb.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@9"></script>
  <script src="js/cerrar_session.js"></script>
  <script src="include/sidebar.js"></script>


  <script>

    function editarHorarioDeCita(){

      let id_user     = localStorage.getItem('id_user');
      let fechaCitas  = $('#listadoCitas option:selected').val();

      $.ajax({
        type: "POST",
        url: "../ajax/socio/mis_horarios/listarEditarHorarios.php",
        data: {id_user: id_user, fechaCitas: fechaCitas},
        dataType: "JSON",
        success: function (res) {
          
        }
      });


    }

    function rellenarListadoDeCitasYabrirModal(){

      $.ajax({
        type: "GET",
        url: "../ajax/socio/mis_horarios/listarProximasCitas.php",
        dataType: "JSON",
        beforeSend:()=>{  $('.loading').css('display','block'); },
        success: function (data) {

          if(data.arrfechas.length > 0){

            $('#listadoCitas').empty(); 

            $.each(data.arrfechas, function (i, val) {

              let opt = `<option value='`+val.fecha+`'>`+val.fecha+`</option>`;

              $(opt).appendTo($('#listadoCitas'));
              
            });

          }

          $('#modalEditarHorario').modal('show');
          
        },complete: ()=>{
          $('.loading').css('display','none');
        }
      });

    }

    function agregarHorario(){

      if($('#1').is(":checked")){
        $lunes = 1;
      }else{
        $lunes = 0;
      }
      
      if($('#2').is(":checked")){
        $martes = 1;
      }else{
        $martes = 0;
      }
      
      if($('#3').is(":checked")){
        $miercoles = 1;
      }else{
        $miercoles = 0;
      }
      
      if($('#4').is(":checked")){
        $jueves = 1;
      }else{
        $jueves = 0;
      }
      
      if($('#5').is(":checked")){
        $viernes = 1;
      }else{
        $viernes = 0;
      }
      
      if($('#6').is(":checked")){
        $sabado = 1;
      }else{
        $sabado = 0;
      }
      
      if($('#7').is(":checked")){
        $domingo = 1;
      }else{
        $domingo = 0;
      }

      if($('#hora').val() == ''){
        Swal.fire(
      'Ha ocurrido un error',
      'La hora no puede estar vacia',
      'error'
      );
      return false;
      }

      if(!$('#1').is(":checked") && !$('#2').is(":checked") && !$('#3').is(":checked") && !$('#4').is(":checked")
      && !$('#5').is(":checked") && !$('#6').is(":checked") && !$('#7').is(":checked") ){
        Swal.fire(
      'Ha ocurrido un error',
      'Debe seleccionar al menos un día',
      'error'
      );
      return false;
      }

      $.ajax({
        type: "POST",
        url: "../ajax/socio/mis_horarios/agregarHorario.php",
        data: {lunes: $lunes,
          martes: $martes,
          miercoles:$miercoles,
          jueves: $jueves,
          viernes: $viernes,
          sabado:$sabado,
          domingo: $domingo,
          hora : $('#hora').val(),
        id_user : localStorage.getItem('id_user')},
        dataType: "JSON",        
        beforeSend: function () {
            $('.loading').css('display','block');
          },
        success: function (res) {
          if(res.result){
            Swal.fire(
            'Agregado!',
            res.message,
            'success'
          )
          listarHorarios();
          $('#agregarHorarioMdl').modal('hide');
          $('#hora').val('');
          $('#1').prop('checked', true);
          $('#2').prop('checked', true);
          $('#3').prop('checked', true);
          $('#4').prop('checked', true);
          $('#5').prop('checked', true);
          $('#6').prop('checked', false);
          $('#7').prop('checked', false);
          
        }else{
            Swal.fire(
              'Ha ocurrido un error',
              res.message,
              'error'
            )
          }
        },complete: function () {
            $('.loading').css('display','none');
          }
        
      });

    }



       function quitarDia($id_dia, $id_horario){

if($id_dia == 1){
  $dia = 'Lunes';
}

if($id_dia == 2){
  $dia = 'Martes';
}

if($id_dia == 3){
  $dia = 'Miércoles';
}

if($id_dia == 4){
  $dia = 'Jueves';
}

if($id_dia == 5){
  $dia = 'Viernes';
}

if($id_dia == 6){
  $dia = 'Sábado';
}

if($id_dia == 7){
  $dia = 'Domingo';
}

const swalWithBootstrapButtons = Swal.mixin({
customClass: {
confirmButton: 'btn btn-success',
cancelButton: 'btn btn-danger'
},
buttonsStyling: false
})

swalWithBootstrapButtons.fire({
title: '¿Estas seguro?',
text: "Se va a quitar el día "+$dia+" al horario!",
icon: 'warning',
showCancelButton: true,
confirmButtonText: 'Si, quitar!',
cancelButtonText: 'No, cancelar!'
}).then((result) => {
if (result.value) {

$.ajax({
type: "POST",
url: "../ajax/socio/mis_horarios/quitarDia.php",
data: {id_dia: $id_dia, id_horario: $id_horario},
dataType: "JSON",        
beforeSend: function () {
    $('.loading').css('display','block');
  },
success: function (res) {
  if(res.result){
    swalWithBootstrapButtons.fire(
    'Eliminado!',
    'El día se ha quitado correctamente',
    'success'
  )
   listarHorarios();

  }else{
    swalWithBootstrapButtons.fire(
      'Ha ocurrido un error',
      res.message,
      'error'
    )
  }
},complete: function () {
    $('.loading').css('display','none');
  }
});


}else{
swalWithBootstrapButtons.fire(
'Cancelado',
'Acción cancelada',
'error'
)
}
})

}

    function agregarDia($id_dia, $id_horario){

      if($id_dia == 1){
        $dia = 'Lunes';
      }
      
      if($id_dia == 2){
        $dia = 'Martes';
      }
      
      if($id_dia == 3){
        $dia = 'Miércoles';
      }
      
      if($id_dia == 4){
        $dia = 'Jueves';
      }
      
      if($id_dia == 5){
        $dia = 'Viernes';
      }
      
      if($id_dia == 6){
        $dia = 'Sábado';
      }
      
      if($id_dia == 7){
        $dia = 'Domingo';
      }

      const swalWithBootstrapButtons = Swal.mixin({
  customClass: {
    confirmButton: 'btn btn-success',
    cancelButton: 'btn btn-danger'
  },
  buttonsStyling: false
})

swalWithBootstrapButtons.fire({
  title: '¿Estas seguro?',
  text: "Se va a agregrar el día "+$dia+" al horario!",
  icon: 'warning',
  showCancelButton: true,
  confirmButtonText: 'Si, agregar!',
  cancelButtonText: 'No, cancelar!'
}).then((result) => {
  if (result.value) {

    $.ajax({
      type: "POST",
      url: "../ajax/socio/mis_horarios/agregarDia.php",
      data: {id_dia: $id_dia, id_horario: $id_horario},
      dataType: "JSON",        
      beforeSend: function () {
          $('.loading').css('display','block');
        },
      success: function (res) {
        if(res.result){
          swalWithBootstrapButtons.fire(
          'Agregado!',
          'El día se ha agregado correctamente',
          'success'
        )
         listarHorarios();

        }else{
          swalWithBootstrapButtons.fire(
            'Ha ocurrido un error',
            res.message,
            'error'
          )
        }
      },complete: function () {
          $('.loading').css('display','none');
        }
    });


  }else{
    swalWithBootstrapButtons.fire(
      'Cancelado',
      'Acción cancelada',
      'error'
    )
  }
})

    }

    function eliminarHorario($id_horario){

      const swalWithBootstrapButtons = Swal.mixin({
  customClass: {
    confirmButton: 'btn btn-success',
    cancelButton: 'btn btn-danger'
  },
  buttonsStyling: false
})

swalWithBootstrapButtons.fire({
  title: '¿Estas seguro?',
  text: "Se va a eliminar el horario!",
  icon: 'warning',
  showCancelButton: true,
  confirmButtonText: 'Si, eliminar!',
  cancelButtonText: 'No, cancelar!'
}).then((result) => {
  if (result.value) {

    $.ajax({
      type: "POST",
      url: "../ajax/socio/mis_horarios/eliminarHorario.php",
      data: {id_horario: $id_horario},
      dataType: "JSON",        
      beforeSend: function () {
          $('.loading').css('display','block');
        },
      success: function (res) {
        if(res.result){
          swalWithBootstrapButtons.fire(
          'Eliminado!',
          'El horario ha sido eliminado correctamente',
          'success'
        )
         listarHorarios();

        }else{
          swalWithBootstrapButtons.fire(
            'Ha ocurrido un error',
            res.message,
            'error'
          )
        }
      },complete: function () {
          $('.loading').css('display','none');
        }
    });


  }else{
    swalWithBootstrapButtons.fire(
      'Cancelado',
      'Acción cancelada',
      'error'
    )
  }
})

    }

    function listarHorarios(){

      $.ajax({
        type: "POST",
        url: "../ajax/socio/mis_horarios/listarHorarios.php",
        data: {id_user : localStorage.getItem('id_user')},
        dataType: "JSON ",beforeSend: function(){
          $('.loading').css('display','block');
        },
        success: function (data) {
          var html = '',
      el = document.getElementById("dateContainer");
      $.each(data, function (key, val) {

         html += `<div class="col-md-3 sm-12 my-1">
                <div class="card">
                <div class="row">

                  <div class="col-7">
                  <div class="green-text">
                    <i class="fa p-2 fa-calendar-check fa-3x"></i>
                  </div><b class="text-nowrap"> 
                  `+val.diasConLetra+`</b>
                  </div>
                  <div class="col-5 text-nowrap my-auto">
                    <b  style="font-size: 1.3em;">`+val.hora+`</b>
                  </div>
                  <div class="col-12 text-center">
                    <button 
                     onclick="eliminarHorario(`+val.id_horario+`)"
                     class="btn btn-danger btn-sm">
                     Eliminar horario
                     </button>
                  </div>
                </div>
              </div></div>`;

      });

      el.innerHTML = html;
        },complete: function () {
          $('.loading').css('display','none');
        }
      });


    }

    $(document).ready(function(){
      listarHorarios();
            /* INCLUDES */

  $('#sidebar_aqui').html(sidebar);

  /* NAVBUTTON */

  $('#menuToggle').on('click',function(){

  $( "#sidebar" ).toggle("normal"); 


  });

    // Animations initialization
    new WOW().init();

    checkLogIn();

  $('#indexSidebar').removeClass('active');
  $('#perfilSidebar').removeClass('active');
  $('#empresasSidebar').removeClass('active');
  $('#horariosSidebar').addClass('active');
  $('#productosSidebar').removeClass('active');
  $('#mensajesSidebar').removeClass('active');
  $('#salaDeEspera').removeClass('active');

 /*    if($nombre != null && $nombre.length > 1 && $id_user != null && $id_user.length > 0 &&
    $token != null && $token.length == 32){
      location.replace('socio/index.html');
    }else{
      console.log('usuario no logeado');
    } */
    });

    $('#1').prop('checked', true);
    $('#2').prop('checked', true);
    $('#3').prop('checked', true);
    $('#4').prop('checked', true);
    $('#5').prop('checked', true);

  
  </script>

</body>

</html>