if("undefined"==typeof jQuery)throw new Error("jQuery is not loaded");$.fn.zabuto_calendar=function(b){var c=$.extend({},$.fn.zabuto_calendar_defaults(),b),a=$.fn.zabuto_calendar_language(c.language);return c=$.extend({},c,a),this.each((function(){var i=$(this);function k(){var x=parseInt(i.data("initYear")),A=parseInt(i.data("initMonth"))-1,C=new Date(x,A,1,0,0,0,0);i.data("initDate",C);var D=!0===i.data("cellBorder")?" table-bordered":"",B=$('<table class="table'+D+'"></table>');B=u(i,B,C.getFullYear(),C.getMonth());var w=f(i),y=$('<div class="zabuto_calendar"></div>'),z;y.append(B),y.append(w),i.append(y),!1!==i.data("jsonData")&&p(i,C.getFullYear(),C.getMonth())}function u(y,A,x,z){var w=new Date(x,z,1,0,0,0,0);return y.data("currDate",w),A.empty(),A=o(y,A=d(y,A=q(y,A,x,z)),x,z),p(y,x,z),A}function f(y){var w=$('<div class="legend" id="'+y.attr("id")+'_legend"></div>'),x=y.data("legendList");return"object"==typeof x&&x.length>0&&$(x).each((function(C,E){if("object"==typeof E&&"type"in E){var D="";switch("label"in E&&(D=E.label),E.type){case"text":if(""!==D){var B="";if("badge"in E){if(void 0===E.classname)var F="badge-event";else var F=E.classname;B='<span class="badge '+F+'">'+E.badge+"</span> "}w.append('<span class="legend-'+E.type+'">'+B+D+"</span>")}break;case"block":if(""!==D&&(D="<span>"+D+"</span>"),void 0===E.classname)var A="event";else var A="event-styled "+E.classname;w.append('<span class="legend-'+E.type+'"><ul class="legend"><li class="'+A+'"></li></ul>'+D+"</span>");break;case"list":if("list"in E&&"object"==typeof E.list&&E.list.length>0){var z=$('<ul class="legend"></ul>');$(E.list).each((function(H,G){z.append('<li class="'+G+'"></li>')})),w.append(z)}break;case"spacer":w.append('<span class="legend-'+E.type+'"> </span>')}}})),w}function q(E,D,G,M){var L=E.data("navIcons"),A=$('<span><span class="glyphicon glyphicon-chevron-left"></span></span>'),Q=$('<span><span class="glyphicon glyphicon-chevron-right"></span></span>');"object"==typeof L&&("prev"in L&&A.html(L.prev),"next"in L&&Q.html(L.next));var K=E.data("showPrevious");"number"!=typeof K&&!1!==K||(K=n(E.data("showPrevious"),!0));var w=$('<div class="calendar-month-navigation"></div>');if(w.attr("id",E.attr("id")+"_nav-prev"),w.data("navigation","prev"),!1!==K){var N=M-1,F=G;-1==N&&(F-=1,N=11),w.data("to",{year:F,month:N+1}),w.append(A),"function"==typeof E.data("actionNavFunction")&&w.click(E.data("actionNavFunction")),w.click((function(R){u(E,D,F,N)}))}var C=E.data("showNext");"number"!=typeof C&&!1!==C||(C=n(E.data("showNext"),!1));var z=$('<div class="calendar-month-navigation"></div>');if(z.attr("id",E.attr("id")+"_nav-next"),z.data("navigation","next"),!1!==C){var x=M+1,P=G;12==x&&(P+=1,x=0),z.data("to",{year:P,month:x+1}),z.append(Q),"function"==typeof E.data("actionNavFunction")&&z.click(E.data("actionNavFunction")),z.click((function(R){u(E,D,P,x)}))}var B=E.data("monthLabels"),J=$("<td></td>").append(w),O=$("<td></td>").append(z),H=$("<span>"+B[M]+" "+G+"</span>");H.dblclick((function(){var R=E.data("initDate");u(E,D,R.getFullYear(),R.getMonth())}));var I=$('<td colspan="5"></td>');I.append(H);var y=$('<tr class="calendar-month-header"></tr>');return y.append(J,I,O),D.append(y),D}function d(z,B){if(!0===z.data("showDays")){var w=z.data("weekStartsOn"),x=z.data("dowLabels");if(0===w){var A=$.extend([],x),C;x=new Array(A.pop()).concat(A)}var y=$('<tr class="calendar-dow-header"></tr>');$(x).each((function(D,E){y.append("<th>"+E+"</th>")})),B.append(y)}return B}function o(E,D,G,L){var C=E.data("ajaxSettings"),F=r(G,L),w=m(G,L),B=h(G,L,1),N=h(G,L,w),A=1,z;0===E.data("weekStartsOn")&&(6==N&&F++,6!=B||0!=N&&1!=N&&5!=N||F--,7==++B&&(B=0));for(var y=0;y<F;y++){for(var x=$('<tr class="calendar-dow"></tr>'),I=0;I<7;I++){if(I<B||A>w)x.append("<td></td>");else{var M=E.attr("id")+"_"+j(G,L,A),K,J=$('<div id="'+(M+"_day")+'" class="day" >'+A+"</div>");J.data("day",A),v(G,L,A)&&(J.addClass("today"),!0===E.data("showToday")&&J.html('<span class="badge badge-today">'+A+"</span>"));var H=$('<td id="'+M+'"></td>');H.append(J),H.data("date",j(G,L,A)),H.data("hasEvent",!1),"function"==typeof E.data("actionFunction")&&(H.addClass("dow-clickable"),H.click((function(){E.data("selectedDate",$(this).data("date"))})),H.click(E.data("actionFunction"))),x.append(H),A++}6==I&&(B=0)}D.append(x)}return D}function g(z,F,E,H){var G=$('<button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>'),y=$('<h4 class="modal-title" id="'+z+'_modal_title">'+F+"</h4>"),I=$('<div class="modal-header"></div>');I.append(G),I.append(y);var D=$('<div class="modal-body" id="'+z+'_modal_body">'+E+"</div>"),C=$('<div class="modal-footer" id="'+z+'_modal_footer"></div>');if(void 0!==H){var x=$("<div>"+H+"</div>");C.append(x)}var A=$('<div class="modal-content"></div>');A.append(I),A.append(D),A.append(C);var w=$('<div class="modal-dialog"></div>');w.append(A);var B=$('<div class="modal fade" id="'+z+'_modal" tabindex="-1" role="dialog" aria-labelledby="'+z+'_modal_title" aria-hidden="true"></div>');return B.append(w),B.data("dateId",z),B.attr("dateId",z),B}function p(y,x,A){var w=y.data("jsonData"),z=y.data("ajaxSettings");return y.data("events",!1),!1!==w?l(y):!1===z||s(y,x,A)}function l(x){var w=x.data("jsonData");return x.data("events",w),e(x,"json"),!0}function s(x,w,A){var z=x.data("ajaxSettings");if("object"!=typeof z||void 0===z.url)return alert("Invalid calendar event settings"),!1;var y={year:w,month:A+1};return $.ajax({type:"GET",url:z.url,data:y,dataType:"json"}).done((function(B){completeYA();var C=[];$.each(B,(function(E,D){C.push(B[E])})),x.data("events",C),e(x,"ajax")})),!0}function e(z,y){var x=z.data("jsonData"),A=z.data("ajaxSettings"),w=z.data("events");!1!==w&&$(w).each((function(F,H){var B=z.attr("id")+"_"+H.date,D=$("#"+B),I=$("#"+B+"_day");if(D.data("hasEvent",!0),void 0!==H.title&&D.attr("title",H.title),void 0===H.classname?D.addClass("event"):(D.addClass("event-styled"),I.addClass(H.classname)),void 0!==H.badge&&!1!==H.badge){var C=!0===H.badge?"":" badge-"+H.badge,E=I.data("day");I.html('<span class="badge badge-event'+C+'">'+E+"</span>")}if(void 0!==H.body){var G=!1;if("json"===y&&void 0!==H.modal&&!0===H.modal?G=!0:"ajax"===y&&"modal"in A&&!0===A.modal&&(G=!0),!0===G){D.addClass("event-clickable");var J=g(B,H.title,H.body,H.footer);$("body").append(J),$("#"+B).click((function(){$("#"+B+"_modal").modal()}))}}}))}function v(y,z,x){var A=new Date,w;return new Date(y,z,x).toDateString()==A.toDateString()}function j(y,z,x){var w,A;return y+"-"+(w=(w=z+1)<10?"0"+w:w)+"-"+(A=x<10?"0"+x:x)}function h(y,z,x){var w,A=new Date(y,z,x,0,0,0,0).getDay();return 0==A?A=6:A--,A}function m(x,y){for(var w=28;t(x,y+1,w+1);)w++;return w}function r(y,A){var w=m(y,A),C,z,B=w,x=h(y,A,1)-h(y,A,w);return x>0&&(B+=x),Math.ceil(B/7)}function t(z,w,x){return w>0&&w<13&&z>0&&z<32768&&x>0&&x<=new Date(z,w,0).getDate()}function n(y,A){!1===y&&(y=0);var z=i.data("currDate"),x=i.data("initDate"),w;if(w=12*(x.getFullYear()-z.getFullYear()),w-=z.getMonth()+1,w+=x.getMonth(),!0===A){if(w<parseInt(y)-1)return!0}else if(w>=0-parseInt(y))return!0;return!1}i.attr("id","zabuto_calendar_"+Math.floor(99999*Math.random()).toString(36)),i.data("initYear",c.year),i.data("initMonth",c.month),i.data("monthLabels",c.month_labels),i.data("weekStartsOn",c.weekstartson),i.data("navIcons",c.nav_icon),i.data("dowLabels",c.dow_labels),i.data("showToday",c.today),i.data("showDays",c.show_days),i.data("showPrevious",c.show_previous),i.data("showNext",c.show_next),i.data("cellBorder",c.cell_border),i.data("jsonData",c.data),i.data("ajaxSettings",c.ajax),i.data("legendList",c.legend),i.data("actionFunction",c.action),i.data("actionNavFunction",c.action_nav),k()})),this},$.fn.zabuto_calendar_defaults=function(){var a=new Date,c,d,b;return{language:!1,year:a.getFullYear(),month:a.getMonth()+1,show_previous:!0,show_next:!0,cell_border:!1,today:!1,show_days:!0,weekstartson:1,nav_icon:!1,data:!1,ajax:!1,legend:!1,action:!1,action_nav:!1}},$.fn.zabuto_calendar_language=function(a){switch(void 0!==a&&!1!==a||(a="es"),a.toLowerCase()){case"en":return{month_labels:["January","February","March","April","May","June","July","August","September","October","November","December"],dow_labels:["Mon","Tue","Wed","Thu","Fri","Sat","Sun"]};case"es":return{month_labels:["Enero","Febrero","Marzo","Abril","Mayo","Junio","Julio","Agosto","Septiembre","Octubre","Noviembre","Diciembre"],dow_labels:["Lu","Ma","Mi","Ju","Vi","SÃ¡","Do"]}}};