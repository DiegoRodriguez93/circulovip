<!DOCTYPE html>
<html lang="es">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <meta http-equiv="Cache-Control" content="no-cache" />
  <meta http-equiv="Pragma" content="no-cache" />
  <meta http-equiv="Expires" content="0" />
  <title>Billetera</title>
  <!-- CSS -->
  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.8.2/css/all.css">
  <link href="css/bootstrap.min.css" rel="stylesheet">
  <link href="css/mdb.min.css" rel="stylesheet">
  <link href="css/style.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdn.datatables.net/responsive/2.2.3/css/responsive.dataTables.min.css">
  <link rel="stylesheet" href="https://cdn.datatables.net/colreorder/1.5.2/css/colReorder.dataTables.min.css">
  <link rel="stylesheet" href="css/dataTables.bootstrap4.min.css">
  <link href="../css/estilosmenu.css" rel="stylesheet">
</head>

<div class="modal fade bd-example-modal-lg" id="mdlTransferir" tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel"
  aria-hidden="true">
  <div class="modal-dialog modal-lg">
    <div class="modal-content">
    <div class="modal-header">
        <h4 class="modal-title w-100" id="myModalLabel">Transferencia de fondos</h4>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <div id="nombre_transferido"></div>
        <div id="cedula_transferido"></div>
        <input type="text" id="monto" class="solo_numeros" placeholder="Monto">
        <input type="hidden" id="cedula_hidden">
      </div>
      <div class="modal-footer">
        <button type="button" id="transferirBtn" class="btn btn-primary btn-sm">Transferir</button>
        <button type="button" class="btn btn-grey btn-sm" data-dismiss="modal">Cerrar</button>
      </div>
    </div>
    </div>
    </div>
  </div>
</div>

<body class="grey lighten-3">

  <!--Main Navigation-->
  <header>

    <!-- Navbar -->
    <nav class="navbar fixed-top navbar-expand-lg navbar-light white scrolling-navbar">
      <div class="container-fluid">

        <!-- Brand -->
        <a class="navbar-brand waves-effect" href="index.html">
          <i class="fas fa-wallet mr-1"></i><strong>Billetera</strong>
        </a>

        <div id="menuToggle" >

          <input type="checkbox">
          <span></span>
          <span></span>
          <span></span>
        </div>

      </div>
    </nav>
    <!-- Navbar -->

<!-- SIDEBAR AQUI -->

<div id="sidebar_aqui"></div>

  </header>
  <!--Main Navigation-->

  <!--Main layout-->
  <main class="pt-5 mx-lg-5">
    <div class="container-fluid mt-5" style="min-height: 480px">

    <div class="row wow fadeIn">

      <div class="col-md-3">    
        <div class="card mb-4 wow fadeIn">

          <!--Card content-->
          <div class="card-body">

              <label for="">Ingresar nombre completo:</label>
              <input type="text" class="form-control" id="name"><br>

                <label for="">Ingresar cedula:</label>
              <input type="text" maxlength="8" class="form-control solo_numeros" id="cedula"><br>
              <div class="text-center">
                <button onclick="ingresarCedula()" class="btn btn-primary">Ingresar</button>
              </div>

             </div>
          </div>
      </div>

      <div class="col-md-9">    
        <div class="card mb-4 wow fadeIn">

          <!--Card content-->
          <div class="card-body">
            <div class="text-center">
              <h5>Cedulas ingresadas</h5>
            </div>
              <!-- Table  -->
              <table id="TablaC" class="table table-hover" style="width:100%">
              <thead>
            <tr class="text-center">
                <th>Cedula</th>
                <th>Name</th>
                <th>Transferir</th>
                <th>Eliminar</th>
            </tr>
                </thead>
                <tbody class="text-center">
                </tbody>
                </table>
              <!-- Table  -->

             </div>
          </div>
      </div>


    </div>

    </div>
  </main>
  <!--Main layout-->

  <!--Footer-->
  <footer class="page-footer text-center font-small primary-color-dark darken-2 mt-5 wow fadeIn" style="
position: fixed;
Width: 100%;
bottom: 0;">

    <!--Copyright-->
    <div class="footer-copyright py-3">
      © 2019 Copyright
      <a href="https://vida.com.uy" target="_blank"> Vida.com.uy </a>
    </div>
    <!--/.Copyright-->

  </footer>
  <!--/.Footer-->

  <div id="modal_aqui"></div>

  <!-- SCRIPTS -->
  <script type="text/javascript" src="js/jquery-3.4.1.min.js"></script>
  <script type="text/javascript" src="js/popper.min.js"></script>
  <script type="text/javascript" src="js/bootstrap.min.js"></script>
  <script type="text/javascript" src="js/mdb.min.js"></script>
  <script src="js/jquery.dataTables.min.js"></script>
  <script src="https://cdn.datatables.net/responsive/2.2.3/js/dataTables.responsive.min.js"></script>
  <script src="https://cdn.datatables.net/colreorder/1.5.2/js/dataTables.colReorder.min.js"></script>
  <script src="../lib/helper.js"></script>
  <script src="../lib/jquerysession.js"></script>
  <script src="js/cerrar_session.js"></script>
  <script src="include/modal.js"></script>
  <script src="include/sidebar.js"></script>
  
  <!-- Initializations -->
  <script type="text/javascript">
    // Animations initialization
    new WOW().init();

    function transferir($cedula,$nombre){
      $('#nombre_transferido').html('Nombre: '+$nombre);
      $('#cedula_transferido').html('Cédula: '+$cedula);
      $('#cedula_hidden').val($cedula);
     $('#mdlTransferir').modal('show');
    }

    function eliminar($id){

      var r = confirm("¿Esta seguro que desea eliminar el acceso directo a la transferencia?");
      if (r == true) {

        $.ajax({
        type: "POST",
        url: "https://vida-apps.com/vidapesos/ajax/eliminar_cedula.php",
        data: {id_cedula: $id},
        dataType: "JSON",
        success: function (res) {
          if(res.result){
              alert(res.message);
              location.reload();
          }else{
              alert(res.message);
          }
        },error: function () {
          alert('Ha ocurrido un error, intenté más tarde');
          }
      });


      }else{
        return false;
      } 

    }



  function ingresarCedula(){

   $cedula = $('#cedula').val();
   $name = $('#name').val();

   if(!comprobarCI($cedula)){
     alert('Cedula inválida');
     return false;
   }

   $.ajax({
     type: "POST",
     url: "https://vida-apps.com/vidapesos/ajax/ingresar_cedula.php",
     data: {id_comercio: $id_comercio, name: $name, cedula:$cedula},
     dataType: "JSON",
     success: function (res) {
       if(res.result){
          alert(res.message);
          location.reload();
       }else{
          alert(res.message);
       }
     },error: function () {
       alert('Ha ocurrido un error, intenté más tarde');
       }
   });



  }

    $(document).ready(function(){

        /* INCLUDES */

        $('#sidebar_aqui').html(sidebar);      
        $('#modal_aqui').html(modal);      

                /* NAVBUTTON */

                $('#menuToggle').on('click',function(){

                $( "#sidebar" ).toggle("normal"); 


                } );

      $('#cedulaSidebar').addClass('active');

      $id_comercio = $.session.get('id_comercio');

      if($id_comercio != null ){
        console.log('Comercio logeado!');
      }else{

        $('#modalLogin').modal('show');
        $("#sidebar").css({"opacity": "0.6"});
      }

      //* TRANSFERIR BUTTON
    $('#transferirBtn').on('click',function () {  

      $id_comercio = $.session.get('id_comercio');
      $monto  = $('#monto').val();
      $cedula = $('#cedula_hidden').val();

      if($cedula == '' ){
        alert('Ha ocurrido un error, intenté más tarde!');
        return false;
      }

      if($monto == '' ){
        alert('Debes ingresar un monto a transferir');
        return false;
      }

      if($monto < 1 ){
        alert('El monto debe ser de un mínimo de 1 peso');
        return false;
      }


      $.ajax({
        type: "POST",
        url: "https://vida-apps.com/vidapesos/ajax/transferir_comercio.php",
        data: {cedula:$cedula,
        monto:$monto,
        id_comercio:$id_comercio},
        dataType: "JSON",
        success: function (res) {
          if(res.result){
            alert(res.message);
            $('#monto').val('');
            $('#mdlTransferir').modal('hide');

          }else{
            alert(res.message);
          }
        }
      });


    });

 
            $('#TablaC').DataTable({lengthMenu: [10],
            ajax: 'https://vida-apps.com/vidapesos/ajax/listar_cedulas.php?id_comercio='+$id_comercio,
            lengthChange: false,
            order: [1,'desc'],
            oLanguage: {
                "sUrl": "../json/traducciontabla.json"
            },responsive: true, colReorder: true, info: false }); 

            $('#TablaT_next').css('color','#79153a!important');
 
    });

  </script>

</body>

</html>
